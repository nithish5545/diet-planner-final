<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Diet Planning</title>
<style>
* { margin:0; padding:0; box-sizing:border-box; font-family: Arial,sans-serif; }
body {
    background: linear-gradient(135deg, #0d0d0d, #1a1a1a, #3b3b3b);
    min-height:100vh;
    display:flex;
    justify-content:center;
    align-items:flex-start;
    padding:20px;
    color:white;
}
.container { width:100%; max-width:700px; background: rgba(255,255,255,0.1); padding:30px; border-radius:15px; margin-top:20px; }
h2 { text-align:center; margin-bottom:20px; }
.card { background: rgba(255,255,255,0.15); padding:20px; margin:15px 0; border-radius:10px; }
.card h3 { margin-bottom:10px; }
select, button { padding:10px; margin-top:10px; border-radius:8px; border:none; }
button { background:#00eaff; color:#000; font-weight:bold; cursor:pointer; transition:0.3s; }
button:hover { background:#00c4d1; }
ul { list-style:none; padding-left:0; }
li { margin-bottom:12px; }
.meal-img { width:150px; border-radius:10px; margin-top:8px; }
</style>
</head>

<body>

<div class="container">
    <h2>Diet Planning</h2>

    <div class="card">
        <h3>Filter Meals</h3>

        <label>Select Country:</label>
        <select id="country">
            <option value="">--Select--</option>
            <option value="Indian">India</option>
            <option value="American">USA</option>
            <option value="Italian">Italy</option>
            <option value="Japanese">Japan</option>
        </select>

        <label>Diet Preference:</label>
        <select id="diet">
            <option value="">--Select--</option>
            <option value="Veg">Veg</option>
            <option value="Non-Veg">Non-Veg</option>
        </select>

        <button onclick="showMeals()">Show Meals</button>
    </div>

    <div class="card">
        <h3>Meals</h3>
        <ul id="mealList"></ul>
    </div>

    <button onclick="location.href='home.html'">Back to Home</button>
</div>

<script>
const user = JSON.parse(localStorage.getItem("user"));

function showMeals() {
    const country = document.getElementById("country").value;
    const diet = document.getElementById("diet").value;
    const mealList = document.getElementById("mealList");

    if (!country || !diet) {
        alert("Please select country and diet preference");
        return;
    }

    mealList.innerHTML = "Loading meals...";

    fetch(`https://www.themealdb.com/api/json/v1/1/filter.php?a=${country}`)
    .then(res => res.json())
    .then(data => {
        mealList.innerHTML = "";

        data.meals.slice(0, 6).forEach(meal => {

            // simple veg / non-veg assumption
            if (diet === "Veg" && meal.strMeal.toLowerCase().includes("chicken")) return;

            const li = document.createElement("li");
            li.innerHTML = `
                <strong>${meal.strMeal}</strong><br>
                <img src="${meal.strMealThumb}" class="meal-img"><br>
                <span id="cal-${meal.idMeal}">Calories: calculating...</span><br>
                <button onclick="loadCalories('${meal.idMeal}')">View Calories</button>
                <button onclick="saveMeal('${meal.strMeal}')">Save ❤️</button>
            `;
            mealList.appendChild(li);

            loadCalories(meal.idMeal);
        });
    });
}

function loadCalories(mealId) {
    fetch(`https://www.themealdb.com/api/json/v1/1/lookup.php?i=${mealId}`)
    .then(res => res.json())
    .then(data => {
        const ingredients = Object.keys(data.meals[0])
            .filter(k => k.startsWith("strIngredient") && data.meals[0][k]);

        const calories = ingredients.length * 40;
        document.getElementById(`cal-${mealId}`).innerText =
            "Calories: ~" + calories + " kcal";
    });
}

function saveMeal(mealName) {
    fetch("http://127.0.0.1:5000/save-meal", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
            mobile: user.mobile,
            meal: mealName
        })
    })
    .then(res => res.json())
    .then(() => alert("Meal saved ❤️"));
}
</script>

</body>
</html>
